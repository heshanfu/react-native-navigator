{"version":3,"sources":["../src/navigate.js"],"names":[],"mappings":"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","file":"navigate.js","sourcesContent":["import React from 'react-native';\nimport Event from './event';\nimport urllite from 'urllite/lib/core';\nimport pathToRegexp from 'path-to-regexp';\n\nconst {\n    Navigator\n} = React;\n\nvar Navigate = React.createClass({\n\n    getInitialState: function() {\n        return {\n            _routes: this._processRoutes(this.props.routes)\n        };\n    },\n\n    componentWillUnmount() {\n      this._listeners && this._listeners.forEach(listener => listener.remove());\n      Event.off(\"RNnavigate.redirect\");\n      Event.off(\"RNnavigate.back\");\n    },\n\n    _parseUrl(path) {\n        return urllite(path || '/');\n    },\n\n    _parseSearch(str) {\n        let parsed = {};\n\n        if (str.indexOf('?') === 0) str = str.slice(1);\n        let pairs = str.split('&');\n\n        pairs.forEach(function(pair) {\n            let keyVal = pair.split('=');\n            parsed[decodeURIComponent(keyVal[0])] = decodeURIComponent(keyVal[1]);\n        });\n\n        return parsed;\n    },\n\n    _matchParams(path) {\n        if (!path) {\n            return false;\n        }\n\n        var matchedRoute = {};\n\n        this.state._routes.some(function(route) {\n            var matches = route.pattern.exec(path);\n\n            if (matches) {\n                if(route.params[0] && route.params[0].name===0){\n                    return false;\n                }\n\n                matchedRoute.component = route.component;\n\n                let params = matches.slice(1, route.params.length + 1);\n                matchedRoute.params = {};\n                params.map(function(_params,index){\n                    matchedRoute.params[route.params[index].name] = _params;\n                });\n\n                return true;\n            }\n\n            return false;\n        });\n\n        return matchedRoute.component ? matchedRoute : false;\n    },\n\n    _processRoutes(routes) {\n        var patterns = [], path, pattern, keys, component;\n\n        for (path in routes) {\n            if (routes.hasOwnProperty(path)) {\n                keys = [];\n                pattern = pathToRegexp(path, keys);\n                component = routes[path];\n\n                patterns.push({ pattern: pattern, params: keys, component: component });\n            }\n        }\n\n        return patterns;\n    },\n\n    _setNavigatorRef(navigator) {\n      if (navigator !== this._navigator) {\n        this._navigator = navigator;\n\n        if (navigator) {\n          var callback = (event) => {\n            // console.log(\n            //   `ReactNativeNavigator: event ${event.type}`,\n            //   {\n            //     route: JSON.stringify(event.data.route),\n            //     target: event.target,\n            //     type: event.type,\n            //   }\n            // );\n          };\n          // Observe focus change events from the owner.\n          this._listeners = [\n            navigator.navigationContext.addListener('willfocus', callback),\n            navigator.navigationContext.addListener('didfocus', callback),\n          ];\n\n          Event.on(\"RNnavigate.redirect\", function(path){\n              let info = {};\n              let replace = false;\n              if(typeof path === \"object\"){\n                  if (path.replace){\n                      delete path.replace;\n                      replace = true;\n                  }\n                  info = Object.assign({},path);\n              } else {\n                  info.id = path;\n              }\n\n              replace ? navigator.replace(info) : navigator.push(info);\n          });\n\n          Event.on(\"RNnavigate.back\", function(opts){\n              let info = {};\n              if(opts && typeof opts === \"object\"){\n                  if(opts.id===\"/\"){\n                      navigator.popToTop();\n                  }\n              }else{\n                   navigator.pop();\n              }\n          });\n\n        }\n      }\n  },\n\n    renderScene(route, nav) {\n        let url = this._parseUrl(route.id);\n        let query = this._parseSearch(url.search);\n        let matchedRoute = this._matchParams(url.pathname);\n\n        if (matchedRoute) {\n            return React.createElement(matchedRoute.component,Object.assign( route.props || {}, {\n                route: route,\n                navigator: nav,\n                query: query,\n                params: matchedRoute.params\n            }));\n        } else if(this.props.routes.hasOwnProperty('/400')) {\n            return React.createElement(this.props.routes['/400'],{\n                route: route,\n                navigator: nav\n            });\n        } else {\n            throw new Error('No route matched path: ' + url.pathname);\n        }\n    },\n\n    render(){\n        return (\n            <Navigator\n                ref={this._setNavigatorRef}\n                style={styles.container}\n                initialRoute={{ path: \"/\", }}\n                renderScene={this.renderScene}\n                configureScene={(route) => {\n                  if (route.mode) {\n                    return Navigator.SceneConfigs[route.mode];\n                  }\n                  return Navigator.SceneConfigs.FloatFromRight;\n                }}\n            />\n        );\n    }\n\n});\n\nNavigate.redirect = function(path){\n    Event.emit(\"RNnavigate.redirect\",path);\n};\n\nNavigate.back = function(opts){\n    Event.emit(\"RNnavigate.back\", opts);\n};\n\nconst styles = {\n    container: {\n      flex: 1,\n    }\n}\n\nexport default Navigate;\n"]}